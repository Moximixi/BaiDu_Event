<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我是精明的小卖家</title>
    <style>
        td,th{
            width: 70px;
            height:70px;
        }
        td{
            text-align: center;
        }
    </style>
</head>
<body>
<from id="area1">
    <input type="checkbox" value="华东" class="one">华东
    <input type="checkbox" value="华南" class="one">华南
    <input type="checkbox" value="华北" class="one" >华北
    <input type="checkbox" value="全选" id="choseAll1">全选
</from>
<form id="area2">
    <input type="checkbox" value="手机" class="two">手机
    <input type="checkbox" value="笔记本" class="two">笔记本
    <input type="checkbox" value="智能音箱" class="two">智能音箱
    <input type="checkbox" value="全选" id="choseAll2">全选
</form>
<table id="tableShow" border="1">
</table>
<script>
    var tableShow=document.querySelector("#tableShow");
    var choseAll1=document.querySelector("#choseAll1");
    var choseAll2=document.querySelector("#choseAll2");
    var ones=document.getElementsByClassName("one");
    var twos=document.getElementsByClassName("two");
    var areaList=[];
    var productList=[];
    /*
    *获取当前已经被点击的数目
    */
    function getCheckedNums(target){
        var j=0;
        for(var i in target){
            if(target[i].checked===true){
                j++;
                //console.log("当前多少个被点击了:"+j);
            }
        }
        return j;
    }
    /*
    * 获得当前多选框选中的数据
    * */
    function pushList(target){
        var list=[];
        for(var i in target){
            if(target[i].checked===true){
                list.push(target[i].value);
            }
        }
        return list;
    }
    /*
    * 赋予点击事件
    * */
    function onclickEvent(target,choseAll){
        var ckNums=0;
        var list=[];
        choseAll.setAttribute("nums",ckNums);
        for(var i in target){
            target[i].onclick=function(){
                ckNums=getCheckedNums(target);//把当前选择的数量存到多选框的nums属性中
                 choseAll.setAttribute("nums",ckNums);
                if(ckNums===0){//阻止一个都没有选中的情况发生
                  this.checked=true;
                }else if(ckNums===target.length){
                    choseAll.checked=true;
                }else{
                    choseAll.checked=false;
                }
                list=pushList(target);//获得当前选择的数据
                if(target===ones){
                    areaList=list;
                }else if(target===twos){
                    productList=list;
                }
                createTable();
            }
        }
    }
    onclickEvent(ones,choseAll1);
    onclickEvent(twos,choseAll2);


    var sourceData = [{
        product: "手机",
        region: "华东",
        sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
    }, {
        product: "手机",
        region: "华北",
        sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
    }, {
        product: "手机",
        region: "华南",
        sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
    }, {
        product: "笔记本",
        region: "华东",
        sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
    }, {
        product: "笔记本",
        region: "华北",
        sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
    }, {
        product: "笔记本",
        region: "华南",
        sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
    }, {
        product: "智能音箱",
        region: "华东",
        sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
    }, {
        product: "智能音箱",
        region: "华北",
        sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
    }, {
        product: "智能音箱",
        region: "华南",
        sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
    }];
    /*
    * 全选的封装
    * */
    function selectAll(btn){
        var inputs2=btn.parentNode.getElementsByTagName("input");//获得自己的父节点的所有子input元素
        for(var i in inputs2){
            inputs2[i].checked=btn.checked;
        }
    }
    choseAll1.onclick=function(){
        selectAll(this);
    };
    choseAll2.onclick=function () {
        selectAll(this);
    };





    var list=[];//从数据库中找到的数据
    /*
    * 在数据库中查找是否存在
    * */
    function findExist(target1,target2){
        var list=[];
        for(var i in sourceData){
            if(sourceData[i].region.indexOf(target1)!==-1&&sourceData[i].product.indexOf(target2)!==-1){
                list.push(sourceData[i]);
            }
        }
        return list;
    }
    /*
    * 在数据库中查找数据
    * */
    //思路：双层循环，找数据，然后push进去
    function findData(){
        var addList=[];
        list=[];
        console.log("选择选的数据上"+areaList);
        console.log("选择选的数据下"+productList);
        for(var i=0;i<areaList.length;i++){
            for(var j=0;j<productList.length;j++){
                list.push(findExist(areaList[i],productList[j]));
            }
        }
        console.log("从数据中找到的数据为:");
        console.log(list);
        /*进行数据转化*/
        addList=transformData(list);
        console.log("转化后的函数为:");
        console.log(addList);
        return addList;
    }
    /*
    * 数据转化函数
    * */
    function transformData(list){
        var addList=[];
        for(var j=0;j<list.length;j++){
            var addList_row=[];
            addList_row.push(list[j][0]["product"]);//这里面加了个[0]
            addList_row.push(list[j][0]["region"]);
            for(var i in list[j][0]["sale"]){
                addList_row.push(list[j][0]["sale"][i]);
            }
            addList[j]=addList_row;
        }
        return addList;
    }
    /*
    * 渲染表格
    * */
    function createTable(){
        //清空内容
        for(var i=tableShow.childNodes.length-1;i>=0;i--){
            tableShow.removeChild(tableShow.childNodes[i]);
        }
        //形成表头
        var addList=["商品","地区","1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];
        var tr=document.createElement("tr");
        for(var i in addList){
            var td=document.createElement("th");
            td.innerText=addList[i];
            tr.appendChild(td);
        }
        tableShow.appendChild(tr);
        //形成内容
        addList=findData();//接受查询到的数据
        for(var j in addList){
            var tr2=document.createElement("tr");
            for(var i in addList[j]){
                var td2=document.createElement("td");
                td2.innerText=addList[j][i];
                tr2.appendChild(td2);
            }
            tableShow.appendChild(tr2);
        }
    }

</script>
</body>
</html>